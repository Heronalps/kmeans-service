{% extends "base.html" %}
{% block title %}K-Means - Report - {{job_id}}{% endblock %}
{% block body %}
  <h1>Report for Job ID: {{job_id}}</h1>
  <p class="text-muted">
    Submitted at {{start_time_clock}} on {{start_time_date}} (UTC)
    <br> File: "{{filename}}".
    <br>Clustered using: [{{cluster_columns|join(', ')}}].
    <br>Scale: "{{scale}}".
  </p>
  <p class="lead">Recommended number of clusters based on the best (highest) BIC score:</p>
    <table class="table table-hover">
      <thead>
        <tr>
          <th>Covariance</th>
          <th>Num. of Clusters</th>
        </tr>
      </thead>
      <tbody>
        {% for covar_type, covar_tied, k in covar_type_tied_k %}
        <tr>
          <td>{{covar_type|capitalize}}-{% if covar_tied %}Tied{% else %}Untied{% endif%}</td>
          <td>{{k}}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  <h3>Cluster Plots</h3>
  <p>
    Recommended cluster assignments are visualized below using the columns {{viz_columns[0]}} and {{viz_columns[1]}}:
  </p>
  <img src="{{url_for('plot_cluster', job_id=job_id, x_axis=viz_columns[0], y_axis=viz_columns[1])}}" class="img-fluid"/>

  <div class="form-group row">
    <form class="form-inline" method="post" enctype="multipart/form-data" action="{{url_for('report')}}">
      <input type="text" id="job_id" name="job_id" placeholder="Job ID" value="{{job_id}}" hidden>
      <div class="col-2">
        <label for="x_axis" class="col-form-label">x-axis:</label>
      </div>
      <div class="col-3">
        <select class="form-control" id="x_axis" name="x_axis">
          {% for column in columns %}
          <option value="{{column}}" {%if column==viz_columns[0] %} selected {% endif %}>{{column}}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-2">
        <label for="y_axis" class="col-form-label">y-axis:</label>
      </div>
      <div class="col-3">
        <select class="form-control" id="y_axis" name="y_axis">
          {% for column in columns %}
          <option value="{{column}}" {%if column==viz_columns[1] %} selected {% endif %}>{{column}}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-2">
        <button id="submit" type="submit" class="btn btn-primary">Reload</button>
      </div>
    </form>
  </div>
  <h3>Spatial Cluster Plots</h3>
  {% if (spatial_columns|length) == 2 %}
  <p>
    Recommended cluster assignments are visualized below using the Latitude and Longitude columns in the data:
  </p>
  <img src="{{url_for('plot_cluster', job_id=job_id, x_axis=spatial_columns[0], y_axis=spatial_columns[1], show_ticks=False)}}" class="img-fluid"/>
  {% else %}
  <p> Not available.</p>
  {% endif %}
  <h3>AIC and BIC Plots</h3>
  <p>
    Akaike Information Criterion (AIC) and Bayesian Information Criterion (BIC) for all covariance and "k" values,
    shown with 95% confidence intervals.
  </p>
  <img src="{{url_for('plot_aic_bic', job_id=job_id)}}" class="img-fluid"/>

{% endblock %}