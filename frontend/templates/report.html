{% extends "base.html" %}
{% block title %}K-Means - Report - {{job_id}}{% endblock %}
{% block body %}
  <h1>Report for Job ID: {{job_id}}</h1>
  <p class="text-muted">
    Submitted at {{start_time_clock}} on {{start_time_date}} (UTC)
    <br> File: "{{filename}}".
    <br>Clustered using: [{{cluster_columns|join(', ')}}].
    <br>Scale: "{{scale}}".
  </p>
  <p class="lead">Recommended number of clusters based on the best (highest) BIC score:</p>
    <table class="table table-hover">
      <thead>
        <tr>
          <th>Covariance</th>
          <th>Num. of Clusters</th>
        </tr>
      </thead>
      <tbody>
        {% for covar_type, covar_tied, k in covar_type_tied_k %}
        <tr>
          <td>{{covar_type|capitalize}}-{% if covar_tied %}Tied{% else %}Untied{% endif%}</td>
          <td>{{k}}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  <h3>Cluster Plots</h3>
  <p>
    Recommended cluster assignments are visualized below using the columns {{viz_columns[0]}} and {{viz_columns[1]}}:
  </p>
  <div class="form-group row">
    <div class="form-inline" id="cluster_plot_reload_form">
      <input type="text" id="job_id" name="job_id" placeholder="Job ID" value="{{job_id}}" hidden>
      <div class="col-2">
        <label for="x_axis" class="col-form-label">x-axis:</label>
      </div>
      <div class="col-3">
        <select class="form-control form-control-sm" id="x_axis" name="x_axis">
          {% for column in columns %}
          <option value="{{column}}" {%if column==viz_columns[0] %} selected {% endif %}>{{column}}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-2">
        <label for="y_axis" class="col-form-label">y-axis:</label>
      </div>
      <div class="col-3">
        <select class="form-control form-control-sm" id="y_axis" name="y_axis">
          {% for column in columns %}
          <option value="{{column}}" {%if column==viz_columns[1] %} selected {% endif %}>{{column}}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-2">
        <button class="btn btn-secondary btn-sm" onclick="reload_cluster_plot()">Reload</button>
      </div>
    </div>
  </div>
  <div id="cluster_plot_loading">
      <i class="fa fa-spinner fa-pulse fa-fw"></i>
      <span>Loading Cluster Plots...</span>
    </div>
  <img id="cluster_plot_img" src="{{url_for('plot_cluster', job_id=job_id, x_axis=viz_columns[0], y_axis=viz_columns[1])}}"
       class="img-fluid" onload="$('#cluster_plot_loading').hide();$('#cluster_plot_img').show();"/>
  <br><br>

  <h3>Spatial Cluster Plots</h3>
  {% if (spatial_columns|length) == 2 %}
  <p>
    Recommended cluster assignments are visualized below:
  </p>
  <div id="spatial_plot_loading">
    <i class="fa fa-spinner fa-pulse fa-fw"></i>
    <span>Loading Spatial Cluster Plots...</span>
  </div>
  <img src="{{url_for('plot_cluster', job_id=job_id, x_axis=spatial_columns[0], y_axis=spatial_columns[1], show_ticks=False)}}"
       class="img-fluid" onload="$('#spatial_plot_loading').hide();"/>
  {% else %}
  <p> Not available.</p>
  {% endif %}
  <br><br>

  <h3>AIC and BIC Plots</h3>
  <p>
    Akaike Information Criterion (AIC) and Bayesian Information Criterion (BIC) for all covariance and "k" values,
    shown with 95% confidence intervals.
  </p>
  <div id="aic_bic_plot_loading">
    <i class="fa fa-spinner fa-pulse fa-fw"></i>
    <span>Loading AIC and BIC Plots...</span>
  </div>
  <img src="{{url_for('plot_aic_bic', job_id=job_id)}}" class="img-fluid"
       onload="$('#aic_bic_plot_loading').hide();"/>

{% endblock %}
{% block scripts %}
<script>
  function reload_cluster_plot(){
      $('#cluster_plot_img').hide();
      $('#cluster_plot_loading').show();
      var url = "/plot/cluster/?job_id={{job_id|safe}}&x_axis=<x_axis>&y_axis=<y_axis>"
      var x_axis = $('#cluster_plot_reload_form option:selected').eq(0).text()
      var y_axis = $('#cluster_plot_reload_form option:selected').eq(1).text()
      url = url.replace("<x_axis>", x_axis)
      url = url.replace("<y_axis>", y_axis)
      $('#cluster_plot_img').attr("src", url);
  }
</script>
{% endblock%}